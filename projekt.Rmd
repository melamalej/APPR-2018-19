---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Mela Malej"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding="UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")

```


```{r rstudio, echo=FALSE, results='asis'}
# Izris povezave do RStudia na Binderju
#source("lib/rstudio.r", encoding="UTF-8")
```

# Izbira teme

Za analizo sem si izbrala najosnovnejše podatke o podjetjih v Sloveniji, kot so število podjetij,
število zaposlenih, prihodki in dobički. Po regijah bom primerjala število podjetij, število oseb, ki delajo v regiji in skupne prihodke v letih med 1999 in 2016, po panogah pa število podjetij, število oseb, ki delajo v panogi, število zaposlenih, prihodke iz prodaje in dobiček.

![](slike/grb.png)

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE, warning=FALSE}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Uvozila sem podatke v obliki CSV s statističnega urada ter v obliki HTML
z Wikipedije. Podatki so v petih razpredelnicah v obliki *tidy data*.

1. `Regije` - podatki o številu podjetij, številu oseb, ki delajo in prihodku za vsako regijo
  - `regija` - spremenljivka: ime regije  (faktor),
  - `leto` - spremenljivka: leto  (število),
  - `število podjetij` - meritev: število podjetij v regiji (število),
  - `število oseb` - meritev: število oseb, ki delajo v regiji - število vseh zaposlenih in     samozaposlenih oseb skupaj (število),
  - `Skupni prihodek (1000 EUR)` - meritev: skupni prihodek podjetij v regiji v 1000 EUR (število);

2. `Panoge2008` - podatki o številu podjetij in številu oseb, ki delajo za vsako panogo od leta 2008 do 2016
  - `panoga` - spremenljivka: ime panoge  (faktor),
  - `leto` - spremenljivka: leto  (število),
  - `število podjetij` - meritev: število podjetij v regiji (število),
  - `število oseb` - meritev: število oseb, ki delajo v regiji - število vseh zaposlenih in     samozaposlenih oseb skupaj (število);
  
3. `Panoge2007` -podatki o številu podjetij in številu oseb, ki delajo za vsako panogo od leta 1999 do 2007
  - `panoga` - spremenljivka: ime panoge  (faktor),
  - `leto` - spremenljivka: leto  (število),
  - `število podjetij` - meritev: število podjetij v regiji (število),
  - `število oseb` - meritev: število oseb, ki delajo v regiji - število vseh zaposlenih in samozaposlenih oseb skupaj (število);
  
4. `Panoge` - podatki o podjethih za vsako panogo 
  - `panoga` - spremenljivka: ime panoge  (faktor),
  - `leto` - spremenljivka: leto  (število),
  - `Prihodki od prodaje (1000 EUR)` - meritev: prihodki od prodaje so prodajne vrednosti kupcem zaračunanih prodanih proizvodov ali trgovskega blaga in materiala ter opravljenih storitev (število),
  - `Bruto poslovni presežek (1000 EUR)` - meritev: Bruto poslovni presežek je presežek, ki nastane iz poslovnih dejavnosti po poplačilu vhodnih faktorjev dela (število),
  - `Število zaposlenih` - meritev: Zaposlene osebe so osebe, ki delajo pri delodajalcu (število);
  
5. `bdp` - podatki o bdp-ju Slovenije
  - `leto` - spremenljivka: leto  (število),
  - `BDP` - meritev: bruto domači proizvod Slovenije (število);

```{r razpredelnice}
kable(head(Regije))
kable(head(Panoge2008))
kable(head(Panoge2007))
kable(head(Panoge))
kable(head(bdp))
```  

Spodnji graf prikazuje porazdelitev števila naselij v občinah.

```{r histogram, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Histogram števila naselij v občinah'}
ggplot(podatki_po_letih, aes(x=Leto, y=Skupno_število_podjetij/1e6))+ 
  geom_line(aes(size=Skupno_število_oseb,color="red")) + xlab("Leto") + ylab("Število") 

```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```

Spodnji zemljevid prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
ggplot() + geom_polygon(data=left_join(zemljevid, povprecja, by=c("OB_UIME"="obcina")),
                        aes(x=long, y=lat, group=group, fill=povprecje)) +
  ggtitle("Povprečno število otrok v družini") + xlab("") + ylab("") +
  guides(fill=guide_colorbar(title="Povprečje"))
```

***

# Napredna analiza podatkov

```{r analiza, echo=FALSE, message=FALSE}
source("analiza/analiza.r", encoding="UTF-8")
```

Spodnji graf prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina=names(skupine),
                                     skupina=factor(skupine)), by="obcina")
, aes(x=povrsina, y=naselja, color=skupina, size=prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color=guide_legend(title="Skupina"),
         size=guide_legend(title="Prebivalci (* 1000)"))
```

***

```{r shiny, echo=FALSE}
shinyAppDir("shiny", options=list(width="100%", height=600))
```
